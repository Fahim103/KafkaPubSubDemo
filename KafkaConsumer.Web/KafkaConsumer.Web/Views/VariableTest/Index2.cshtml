@model KafkaConsumer.Web.Controllers.VariableModel

@{
    ViewBag.Title = "Index2";
}

<h2>Index</h2>
<h3>Process ID: @Model.ProcessId</h3>
<h4>Consumer Group: @Model.ConsumerGroupId</h4>

<div>
    <h4>VariableModel</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Message)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Message)
        </dd>

    </dl>
</div>
<hr />
<hr />
<div>
    <h4>List</h4>
    <hr />
    <ul id="kafkaDataList">

    </ul>
</div>
<p>
    @Html.ActionLink("Edit", "Edit", new { /* id = Model.PrimaryKey */ }) |
    @Html.ActionLink("Back to List", "Index")
</p>

@section signalR {
    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <script src="/signalr/hubs"></script>
    <script type="text/javascript">

        $(function () {
            var hubNotify = $.connection.testMessageHub;
            let count = 0;
            $.connection.hub.start().done(function () {
                console.log("Connecting to hub...")
                getAll();
            });

            hubNotify.client.refreshKafkaData = function (message) {
                console.log("Getting data from kafka " + count);
                count = count + 1;
                getAll(message);
            };
        });

        function getAll(data) {
            if (data) {
                console.log("Get All method");
                var dataList = $('#kafkaDataList');
                dataList.append('<li>' + data + '</li>');
            }
            //console.log(data);
        }
    </script>
}
